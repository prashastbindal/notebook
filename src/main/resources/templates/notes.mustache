<!doctype html>
<html>
<head>
    <title>NoteBook</title>
    {{> header}}

    <link href="/css/simple-sidebar.css" rel="stylesheet">
</head>
<body>
<main>
{{> navbar}}

<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
        <div class="sidebar-heading">
            <div id="course-name-header">{{ courseName }}</div>
        </div>
        <div class="show sidebar-heading">
            <form id="search-form">
                <div class="input-group mb-3">
                    <input class="form-control" name="search-notes" type="text" id="searchbar" placeholder="Search Notes">
                    <div class="input-group-append">
                        <button class="btn btn-outline-primary my-2 my-sm-0"
                        id="searchbutton" onclick="searchcallback({{courseId}})">Search</button>
                    </div>
                </div>
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Sort By
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                        <button class="dropdown-item" type="button"
                            id="sortbutton" onclick="sortcallback()">Views</button>
                        <button class="dropdown-item" type="button">Date
                            Added</button>
                        <button class="dropdown-item" type="button">Upvotes</button>
                    </div>
                    <a class="btn btn-outline-primary my-2 my-sm-0"
                       id="add-note-button"
                       href="/courses/{{courseId}}/addNote">Add a Note</a>
                </div>
            </form>
        </div>
        <div class="list-group list-group-flush" id="note-list">
            {{#noteList}}
                <a data-courseId="{{courseId}}" data-noteId="{{id}}"
                   class="note-select list-group-item
                   list-group-item-action">{{ title }} by {{ creator }}
                        <br> Upvotes: {{upvotes}} </a>

            {{/noteList}}
        </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">
        <div class="container-fluid" id="note-frame-container">
            <iframe id="note-frame" src=""></iframe>
        </div>
    </div>
    <!-- /#page-content-wrapper -->

</div>

<style>
    #note-frame-container {
        height: 100%;
    }
    #note-frame {
        border: none;
        width: 100%;
        height: 100%;
    }
</style>

<script>
$(function(){
    $(".note-select").click(function(e) {
        $('#note-list .active').removeClass('active');
        $(this).addClass('active');

        e.preventDefault();
        $("#note-frame").attr("src", "".concat("/courses/", e.target.dataset.courseid, "/notes-preview/", e.target.dataset.noteid));
    });
});

    $('#search-form').submit(function(ev) {
        ev.preventDefault();
        // ajax stuff...
    });

    function searchcallback(courseId){
        console.log("search button clicked")
        var searchKey = $("#searchbar").val();
        console.log(searchKey)
        $.ajax({
             type: "GET",
             url: "search/"+ searchKey,
             contentType: "application/json",
             success: function (data, status, jqXHR) {
                $("#note-list").empty();

                data.map(function(note){
                    $("#note-list").append('<a data-courseId="' + note.courseId + '" data-noteId="' + note.id + '" class="note-select list-group-item' +
                    ' list-group-item-action">' + note.title + ' by ' + note.creator + '</a>')
                });

                $(".note-select").click(function(e) {
                        $('#note-list .active').removeClass('active');
                        $(this).addClass('active');

                        e.preventDefault();
                        $("#note-frame").attr("src", "".concat("/courses/", e.target.dataset.courseid, "/notes-preview/", e.target.dataset.noteid));
                    });
             },

             error: function (jqXHR, status) {
                 // error handler
                 console.log(jqXHR);
                 alert('fail' + status.code);
             }
         });

    }

    function sortcallback(){
        console.log("sort button clicked")
        var mylist = $('#note-list');
        var listitems = mylist.children('a').get();
        listitems.sort(function(a, b) {
           return $(a).text().toUpperCase().localeCompare($(b).text().toUpperCase());
        })
        $.each(listitems, function(idx, itm) { mylist.append(itm); });

    };

</script>

<!-- optional script if we want to make the sidebar toggleable -->
<!--<script>-->
<!--    $("#menu-toggle").click(function(e) {-->
<!--        e.preventDefault();-->
<!--        $("#wrapper").toggleClass("toggled");-->
<!--    });-->
<!--</script>-->

</main>
{{> footer}}

</body>
</html>